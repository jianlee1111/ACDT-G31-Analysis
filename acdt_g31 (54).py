# -*- coding: utf-8 -*-
"""acdt_g31

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1F5fm0D95_3CLMpKv3LVVCJCWz4Vwmcv_
"""

import streamlit as st
import pandas as pd

DATA_FILE = "ACDT_final_dataset.csv"

@st.cache_data
def read_and_clean(path: str, debug=False):
    raw = None
    last_err = None
    for enc in ('utf-8-sig', 'cp949'):
        try:
            raw = pd.read_csv(path, encoding=enc, header=None, engine='python')
            break
        except Exception as e:
            last_err = e
    if raw is None:
        raise RuntimeError(f"CSV reading fail: {last_err}")

    if debug:
        st.subheader("Debug Mode")
        st.write(f"shape: {raw.shape}")
        st.write("row 0 (year):", raw.iloc[0, :].astype(str).tolist()[:30])
        st.write("row 1 (indicator names):", raw.iloc[1, :].astype(str).tolist()[:30])
        st.dataframe(raw.head(6))
        st.info("Stopped application after listing data")
        st.stop()

    # ì—°ë„ ë° ì§€í‘œ ì¶”ì¶œì€ ì´í›„ì—...

    return raw  # í˜¹ì€ í›„ì²˜ë¦¬ëœ dataframe ë°˜í™˜

# UIì—ì„œ ë””ë²„ê·¸ í† ê¸€ êµ¬í˜„ ë¶€ë¶„ ì˜ˆì‹œ

st.title("ACDT G31 ë¶„ì„")

debug_mode = st.sidebar.checkbox("Debug", False)

df_raw = read_and_clean(DATA_FILE, debug=debug_mode)

if debug_mode:
    st.warning("Stopped by debug mode")
    st.stop()

# ê·¸ ì™¸ ë°ì´í„° ì²˜ë¦¬, ë¶„ì„, ì‹œê°í™” ë¡œì§ ì§„í–‰

# report_app.py
import streamlit as st
import pandas as pd

st.set_page_config(
    page_title="ACDT Group 31 â€” GERD â†’ GDP Report",
    layout="wide",
    page_icon="ğŸ“ˆ",
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# í—¤ë”
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.title("ğŸ“ˆ GERD â†’ GDP Analysis â€” Report View (ACDT Group 31)")
st.caption("Linear Regression â€¢ Multiple Linear Regression (Confounder / Mediator / Moderator) â€¢ Key Implications")
st.markdown("---")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1) Linear Regression (ë‹¨ë³€ëŸ‰)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("1) Linear Regression (ë‹¨ë³€ëŸ‰)")

colL, colR = st.columns(2)

with colL:
    st.subheader("GERD (2020) â†’ GDP (2022)")
    lin_2022 = pd.DataFrame(
        [
            ["Slope (Î²â‚)", "0.6330"],
            ["Intercept (Î²â‚€)", "0.7860"],
            ["R (corr.)", "0.7754"],
            ["p-value", "0.0000"],
            ["Std. Error", "0.1099"],
        ],
        columns=["Metric", "Value"],
    )
    st.dataframe(lin_2022, hide_index=True, use_container_width=True)
    st.markdown(
        "ë¡œê·¸-ë¡œê·¸ í•´ì„: **GERD 1% ì¦ê°€ â†’ GDP ì•½ 0.63% ì¦ê°€ ê²½í–¥** (í†µê³„ì ìœ¼ë¡œ ë§¤ìš° ìœ ì˜)."
    )

with colR:
    st.subheader("GERD (2020) â†’ GDP (2023)")
    lin_2023 = pd.DataFrame(
        [
            ["Slope (Î²â‚)", "0.6324"],
            ["Intercept (Î²â‚€)", "0.8005"],
            ["R (corr.)", "0.7746"],
            ["p-value", "0.0000"],
            ["Std. Error", "0.1101"],
        ],
        columns=["Metric", "Value"],
    )
    st.dataframe(lin_2023, hide_index=True, use_container_width=True)
    st.markdown("ë‘ í•´ ëª¨ë‘ íš¨ê³¼ í¬ê¸°ì™€ ìœ ì˜ì„±ì´ ê±°ì˜ ë™ì¼í•¨.")

st.markdown("---")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2) Variables from the dataset
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("2) Variables from the Dataset")

c1, c2, c3 = st.columns(3)

with c1:
    st.subheader("ğŸ§­ Moderators")
    df_mod = pd.DataFrame(
        [
            ["Government incentives", "Government-financed BERD (%)"],
            ["Venture funding", "Business-financed BERD (%)"],
            ["Labor market", "R&D Personnel per 1000 employees"],
        ],
        columns=["Concept", "Dataset Variable"],
    )
    st.dataframe(df_mod, hide_index=True, use_container_width=True)

with c2:
    st.subheader("ğŸ§ª Mediators")
    df_med = pd.DataFrame(
        [
            ["Innovation output", "Resident / Non-resident Patents"],
            ["R&D human capital", "R&D Researchers per million"],
            ["Technological exports", "High-tech Export Share"],
            ["Productivity of firms", "Business R&D Personnel (FTE)"],
        ],
        columns=["Concept", "Dataset Variable"],
    )
    st.dataframe(df_med, hide_index=True, use_container_width=True)

with c3:
    st.subheader("âš ï¸ Confounders")
    df_conf = pd.DataFrame(
        [
            ["Fiscal capacity", "GDP per capita"],
            ["Population size", "Population / Labor size"],
        ],
        columns=["Concept", "Dataset Variable"],
    )
    st.dataframe(df_conf, hide_index=True, use_container_width=True)

st.markdown("---")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3) Multiple Linear Regression (Model 1â€“4)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("3) Multiple Linear Regression (Model 1â€“4)")

st.subheader("ğŸ“‹ Model Comparison (ìš”ì•½í‘œ)")
summary_rows = [
    ["Model 1", "Log_Real_GDP ~ Log_GERD", "0.494", "0.5334", "0.001", "ì§ì ‘íš¨ê³¼(ë‹¨ë³€ëŸ‰)"],
    ["Model 2", "Log_Real_GDP ~ Log_GERD + GDP_per_Capita", "0.476", "0.5044", "0.003", "êµë€í†µì œ(1)"],
    ["Model 3", "Log_Real_GDP ~ Log_GERD + GDP_pc + Mediators", "0.700", "0.3797", "0.020", "ë§¤ê°œë³€ìˆ˜ í¬í•¨"],
    ["Model 4", "Log_Real_GDP ~ Log_GERD * GovFinanced_BERD(%) + ...", "0.775", "1.0697", "<0.001", "ì¡°ì ˆ(ìƒí˜¸ì‘ìš©)"],
]
df_models = pd.DataFrame(
    summary_rows, columns=["Model", "Formula (ìš”ì•½)", "Adj. RÂ²", "Î²(Log_GERD)", "p(Log_GERD)", "Note"]
)
st.dataframe(df_models, hide_index=True, use_container_width=True)

with st.expander("ğŸ“˜ Full outputs (ìš”ì•½ ë°œì·Œ)"):
    st.code(
        """Model 1 â€” Adj. RÂ²: 0.494 | Log_GERD: 0.5334 (p=0.001)
Model 2 â€” Adj. RÂ²: 0.476 | Log_GERD: 0.5044 (p=0.003) | GDP_per_Capita: p=0.491
Model 3 â€” Adj. RÂ²: 0.700 | Log_GERD: 0.3797 (p=0.020) | Resident Patents: pâ‰ˆ0.053
Model 4 â€” Adj. RÂ²: 0.775 | ln_GERDÃ—GovFinanced_BERD(%): âˆ’0.0895 (p=0.001)
* Condition number large â†’ ë‹¤ì¤‘ê³µì„ ì„± ê°€ëŠ¥ì„± ìœ ì˜"""
    )

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4) Interpretation & Implications
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("4) Interpretation & Implications")

bullets = """
- **ì¼ê´€ëœ ì–‘(+) íš¨ê³¼**: ëª¨ë“  ëª¨í˜•ì—ì„œ `Log(GERD)` â†— `Log(Real GDP)` (*p* < .05)
- **ë§¤ê°œ ê°€ëŠ¥ì„±**: Resident Patentsê°€ **ë¶€ë¶„ ë§¤ê°œ** ì‹ í˜¸ (*p* â‰ˆ .053)
- **ì¡°ì ˆ íš¨ê³¼**: Government-financed BERD(%)ê°€ ë†’ì„ìˆ˜ë¡ GERDâ†’GDP íš¨ê³¼ **ì•½í™”** (ìƒí˜¸ì‘ìš© *p* = .001)
- **ì„¤ëª…ë ¥ í–¥ìƒ**: Adjusted RÂ² `0.494 â†’ 0.775` (ëª¨í˜• í™•ì¥ì— ë”°ë¼ ì¦ê°€)
- **í•´ì„ íŒ**: ë¡œê·¸â€“ë¡œê·¸ ëª¨í˜•ì—ì„œ Î²ëŠ” íƒ„ë ¥ì„±(elasticity): GERD 1% ì¦ê°€ ì‹œ GDPê°€ í‰ê· ì ìœ¼ë¡œ Î²% ë³€ë™
"""
st.markdown(bullets)

st.markdown("---")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5) Summary Narrative (ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ì€ ë³¸ë¬¸)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.header("Appendix â€” Full Narrative (ê³¼ì œ ì œì¶œìš© ë³¸ë¬¸)")
long_text = """
Summary
This analysis was conducted to examine the causal impact of Gross Domestic Expenditure on R&D (GERD) on Real GDP.
Four regression models were sequentially estimated, gradually adding confounding, mediating, and moderating variables to identify the underlying causal structure.
The changes in regression coefficients, statistical significance, and explanatory power (Adjusted RÂ²) were analyzed to interpret the causal relationships.

Model 1: Simple Linear Regression (Log_Real_GDP ~ Log_GERD)
Model 1 estimates the simple linear relationship between Log(GERD) and Log(Real GDP).
The regression coefficient (Î²â‚) is positive and statistically significant (p < 0.05), indicating that as GERD increases, Real GDP tends to increase correspondingly.
The Adjusted RÂ² is approximately 0.494, suggesting that Log(GERD) explains about 49.4% of the variance in Log(Real GDP).
Thus, GERD can be considered a major explanatory factor contributing to economic growth.

Model 2: Adding a Confounding Variable (Log_Real_GDP ~ Log_GERD + GDP_per_Capita)
Model 2 adds GDP per Capita as a confounding variable to the basic model. The variables Total Population and Labor Force Size were unavailable in the dataset and therefore excluded.
The analysis shows that GDP per Capita is statistically insignificant (p = 0.491), indicating that it does not have a meaningful impact on Real GDP in this model.
Meanwhile, the coefficient for Log(GERD) remains statistically significant (p = 0.003), suggesting that the positive relationship between GERD and Real GDP persists even after controlling for GDP per Capita.
The Adjusted RÂ² slightly decreases to 0.476, possibly due to the added confounder not substantially improving explanatory power, or as a result of penalization for increased model complexity.

Model 3: Adding Mediating Variables (Log_Real_GDP ~ Log_GERD + GDP_per_Capita + Innovation Variables)
Model 3 includes mediating variables â€” Resident / Non-resident Patent Applications, R&D Researchers per Million People,
High-tech Export Share (% of Manufactured Exports), and Business R&D Personnel (FTE) â€” in addition to Log(GERD) and GDP per Capita.
The coefficient for Log(GERD) slightly decreases (Î² â‰ˆ 0.380) but remains statistically significant (p = 0.020).
This suggests that part of the relationship between GERD and Real GDP may be mediated by innovation, human capital, or technological diffusion.
Among the mediators, Resident Patent Applications shows a near-significant result (p = 0.053), implying that domestic patent activity might partially explain how GERD affects Real GDP.
Other mediators were not statistically significant. The Adjusted RÂ² increases substantially to approximately 0.700, indicating that including mediating variables substantially improves the modelâ€™s explanatory power.

Model 4: Adding a Moderating Effect (Log_Real_GDP ~ Log_GERD * GovFinanced_BERD_pct + Mediators + Confounder)
Model 4 adds an interaction term between Log(GERD) and Government-financed BERD (%) to test for a moderating effect.
The interaction term (Log_GERD Ã— GovFinanced_BERD_pct) is highly significant (p = 0.001), suggesting that the effect of GERD on Real GDP varies depending on the proportion of government-financed R&D expenditure.
The coefficient for the interaction term (Î² = -0.0895) is negative, implying that as the share of government financing in R&D increases, the positive impact of GERD on Real GDP tends to weaken.
The coefficient for Log(GERD) itself increases (Î² â‰ˆ 1.070) compared to Model 3 and remains highly significant (p < 0.001).
This represents the effect of GERD on Real GDP when the moderator (Government-financed BERD) equals zero.
Given the significant interaction, the effect size of GERD should be interpreted conditionally on the level of government financing.
The Adjusted RÂ² further increases to approximately 0.775, showing that Model 4 provides the best overall explanatory power.

Key Findings and Implications
1. Relationship between GERD and Real GDP
Across all models, Log(GERD) consistently shows a statistically significant and positive relationship with Real GDP. This provides empirical support for the notion that R&D investment is a key driver of economic growth.
2. Mediating Effects
Resident Patent Applications partially mediates the relationship between GERD and Real GDP, suggesting that R&D expenditure contributes to economic growth indirectly through innovation activities. Other mediators were not statistically significant, indicating that the mediating strength may be limited.
3. Moderating Effects
Government-financed BERD (%) moderates the relationship between GERD and Real GDP. The positive effect of GERD on GDP tends to weaken as the proportion of government-financed R&D increases. This finding implies that the efficiency of R&D investment may vary depending on the balance between public and private funding structures.
4. Model Fit Comparison
The Adjusted RÂ² values steadily improve as the models expand (0.494 â†’ 0.476 â†’ 0.700 â†’ 0.775). This indicates that incorporating mediating and moderating variables yields a more comprehensive and accurate explanation of Real GDP fluctuations compared to a simple model.

Conclusion
The multiple regression analysis demonstrates that GERD exerts a consistently positive impact on Real GDP.
However, this effect operates through both indirect innovation pathways (e.g., patent applications) and conditional moderation effects depending on the level of government-financed R&D.
The results reveal that the relationship is not a simple â€œR&D â†’ Growthâ€ linear link, but rather a multi-stage causal chain â€” â€œR&D â†’ Innovation â†’ Productivity â†’ Growthâ€ â€” that is further conditioned by policy environments such as government funding ratios.
Therefore, future R&D policies should focus not merely on expanding total expenditure, but also on optimizing the qualitative composition of investment â€” balancing government and private funding, strengthening human capital, and promoting innovation output efficiency.
"""
with st.expander("ë³¸ë¬¸ í¼ì¹˜ê¸° / ì ‘ê¸°", expanded=False):
    st.markdown(long_text)

# ë‹¤ìš´ë¡œë“œ(ì„ íƒ)
st.download_button(
    "â¬‡ï¸ Download narrative as .txt",
    data=long_text,
    file_name="ACDT_G31_Report_Summary.txt",
    mime="text/plain",
)
st.caption("Â© ACDT Group 31 â€” Streamlit Report View")